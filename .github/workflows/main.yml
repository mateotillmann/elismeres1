name: Deploy to Cloudflare Workers

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # Checkout the code from the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Set up Node.js (Install a version of Node.js)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16' # Adjust the Node.js version if necessary

      # Install pnpm (using npm to install pnpm)
      - name: Install pnpm
        run: |
          npm install -g pnpm
          pnpm --version  # Check that pnpm was installed correctly

      # Install dependencies using pnpm
      - name: Install dependencies
        run: pnpm install --frozen-lockfile  # Using frozen lockfile to ensure exact versions

      # Build the project
      - name: Build project
        run: pnpm build  # Run build command defined in your package.json

      # Deploy to Cloudflare Workers (Use the wrangler CLI to deploy)
      - name: Deploy to Cloudflare Workers
        run: |
          npm install -g wrangler  # Install wrangler globally
          wrangler publish  # Deploy using wrangler, make sure wrangler.toml is set up correctly
        env:
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}  # Ensure you have the CF_API_TOKEN secret set up in GitHub

